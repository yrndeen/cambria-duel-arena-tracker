<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leaderboard - Cambria Duel Arena Tracker</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdn.ethers.io/lib/ethers-5.7.2.umd.min.js"></script>
<script src="config.js"></script>
<script src="web3-utils.js"></script>
<style>
:root {
/* Red theme (default) */
--primary: #c62828;
--primary-light: #ff5f52;
--primary-dark: #8e0000;
--secondary: #ff5252;
--dark: #1a0f0f;
--dark-light: #2a1717;
--text: #f5f5f5;
--text-secondary: #b3b3b3;
--success: #00cc66;
--danger: #ff4d4d;
}

* {
margin: 0;
padding: 0;
box-sizing: border-box;
}

body {
font-family: 'Roboto', sans-serif;
background-color: var(--dark);
color: var(--text);
line-height: 1.6;
}

.container {
max-width: 1200px;
margin: 0 auto;
padding: 0 20px;
}

header {
background: linear-gradient(to right, var(--primary-dark), var(--primary));
padding: 20px 0;
box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
position: sticky;
top: 0;
z-index: 100;
}

.header-content {
display: flex;
justify-content: space-between;
align-items: center;
}

.chain-toggle {
display: flex;
gap: 12px;
margin: 0 20px;
background: var(--dark-lighter);
padding: 6px;
border-radius: 12px;
border: 1px solid var(--border);
}

.chain-btn {
background: transparent;
border: none;
color: var(--text-secondary);
padding: 10px 18px;
border-radius: 8px;
cursor: pointer;
transition: all 0.3s ease;
display: flex;
align-items: center;
gap: 8px;
font-size: 14px;
font-weight: 600;
position: relative;
overflow: hidden;
}

.chain-btn::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
opacity: 0;
transition: opacity 0.3s ease;
border-radius: 8px;
}

.chain-btn:hover::before {
opacity: 0.1;
}

.chain-btn:hover {
color: var(--text);
transform: translateY(-1px);
}

.chain-btn.active {
background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
color: white;
box-shadow: 0 4px 12px rgba(106, 61, 154, 0.3);
}

.chain-btn.active:hover {
transform: translateY(-2px);
box-shadow: 0 6px 16px rgba(106, 61, 154, 0.4);
}

.chain-btn.active::before {
opacity: 0;
}

.chain-icon {
font-size: 18px;
position: relative;
z-index: 1;
}

.chain-btn span:last-child {
position: relative;
z-index: 1;
}

.logo {
font-family: 'Orbitron', sans-serif;
font-size: 28px;
font-weight: 700;
display: flex;
align-items: center;
}

.logo-icon {
margin-right: 10px;
font-size: 32px;
}

nav ul {
display: flex;
list-style: none;
}

nav ul li {
margin-left: 25px;
}

nav ul li a {
color: var(--text);
text-decoration: none;
font-weight: 500;
transition: color 0.3s;
padding: 5px 10px;
border-radius: 4px;
}

nav ul li a:hover {
color: var(--secondary);
}

.hero {
text-align: center;
padding: 60px 0;
background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%234a2a75"/><path d="M0 0L100 100" stroke="%236a3d9a" stroke-width="2"/><path d="M100 0L0 100" stroke="%236a3d9a" stroke-width="2"/></svg>');
background-size: cover;
margin-bottom: 40px;
}

.hero h1 {
font-family: 'Orbitron', sans-serif;
font-size: 42px;
margin-bottom: 20px;
color: var(--secondary);
}

.hero p {
font-size: 18px;
max-width: 700px;
margin: 0 auto 30px;
color: var(--text-secondary);
}

.leaderboard-filters {
display: flex;
justify-content: center;
gap: 20px;
margin-bottom: 40px;
flex-wrap: wrap;
}

.filter-btn {
padding: 10px 20px;
background-color: var(--dark-light);
color: var(--text);
border: 2px solid var(--primary);
border-radius: 25px;
cursor: pointer;
font-weight: 500;
transition: all 0.3s;
}

.filter-btn.active {
background-color: var(--primary);
color: white;
}

.filter-btn:hover {
background-color: var(--primary-light);
color: white;
}

.leaderboard-table {
width: 100%;
border-collapse: collapse;
background-color: var(--dark-light);
border-radius: 8px;
overflow: hidden;
margin-bottom: 40px;
}

.leaderboard-table th, .leaderboard-table td {
padding: 15px;
text-align: left;
border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.leaderboard-table th {
background-color: var(--primary);
font-weight: 500;
}

.leaderboard-table tr:hover {
background-color: rgba(106, 61, 154, 0.1);
}

.rank {
font-family: 'Orbitron', sans-serif;
font-weight: 700;
font-size: 18px;
}

.rank-1 { color: #ffd700; }
.rank-2 { color: #c0c0c0; }
.rank-3 { color: #cd7f32; }

.wallet-address {
font-family: 'Orbitron', sans-serif;
color: var(--secondary);
}

.profit {
color: var(--success);
font-weight: 500;
}

.loss {
color: var(--danger);
font-weight: 500;
}

.win-rate {
font-weight: 500;
}

footer {
background-color: var(--dark-light);
padding: 30px 0;
text-align: center;
margin-top: 60px;
}

.footer-content {
display: flex;
flex-direction: column;
align-items: center;
}

.social-links {
display: flex;
margin: 20px 0;
}

.social-links a {
display: flex;
align-items: center;
justify-content: center;
width: 40px;
height: 40px;
border-radius: 50%;
background-color: var(--primary);
color: white;
margin: 0 10px;
text-decoration: none;
transition: transform 0.3s;
}

.social-links a:hover {
transform: translateY(-3px);
}

@media (max-width: 768px) {
.header-content {
flex-direction: column;
}

nav ul {
margin-top: 20px;
}

.leaderboard-filters {
flex-direction: column;
align-items: center;
}

.leaderboard-table {
font-size: 14px;
}

.leaderboard-table th, .leaderboard-table td {
padding: 10px;
}

.fee-info {
background-color: rgba(0, 180, 216, 0.1);
border: 1px solid var(--secondary);
border-radius: 8px;
padding: 15px;
margin: 20px 0;
font-size: 14px;
color: var(--text-secondary);
}

.fee-info strong {
color: var(--secondary);
}
}
</style>
</head>
<body>
<header>
<div class="container">
<div class="header-content">
<div class="logo">
<span class="logo-icon">‚öîÔ∏è</span>
<span>Cambria Duel Tracker</span>
</div>

<div class="chain-toggle">
<button class="chain-btn active" data-chain="abstract" onclick="switchChain('abstract')">
<span class="chain-icon">üü¢</span>
<span>Abstract L2</span>
</button>
<button class="chain-btn" data-chain="ronin" onclick="switchChain('ronin')">
<span class="chain-icon">‚öîÔ∏è</span>
<span>Ronin</span>
</button>
</div>

<nav>
<ul>
<li><a href="index.html">Home</a></li>
<li><a href="leaderboard.html">Leaderboard</a></li>
<li><a href="statistics.html">Statistics</a></li>
<li><a href="about.html">About</a></li>
<li><a href="donate.html">Donate</a></li>
</ul>
</nav>
</div>
</div>
</header>

<section class="hero">
<div class="container">
<h1>Duel Arena Leaderboard</h1>
<p>Top performers in the Cambria Duel Arena ranked by profit and win rate</p>
</div>
</section>

<main class="container">
<div class="leaderboard-filters">
<button class="filter-btn active" data-filter="profit">Top Profit</button>
<button class="filter-btn" data-filter="wins">Most Wins</button>
<button class="filter-btn" data-filter="winrate">Best Win Rate</button>
<button class="filter-btn" data-filter="volume">Highest Volume</button>
</div>


<table class="leaderboard-table" id="leaderboardTable">
<thead>
<tr>
<th>Rank</th>
<th>Wallet Address</th>
<th>Total ETH Won</th>
<th>Total Profit</th>
<th>Win Rate</th>
<th>Total Duels</th>
<th>Volume</th>
</tr>
</thead>
<tbody>
<tr>
<td><span class="rank rank-1">1</span></td>
<td class="wallet-address">0x8a34c7a0...b2d1f</td>
<td class="profit">8.200 ETH</td>
<td class="profit">+0.412 ETH</td>
<td class="win-rate">60.6%</td>
<td>142</td>
<td>4.582 ETH</td>
</tr>
<tr>
<td><span class="rank rank-2">2</span></td>
<td class="wallet-address">0xab45f1c2...d67b9</td>
<td class="profit">7.800 ETH</td>
<td class="profit">+0.390 ETH</td>
<td class="win-rate">58.2%</td>
<td>156</td>
<td>5.120 ETH</td>
</tr>
<tr>
<td><span class="rank rank-3">3</span></td>
<td class="wallet-address">0xcf89d1e0...a43e2</td>
<td class="profit">6.480 ETH</td>
<td class="profit">+0.324 ETH</td>
<td class="win-rate">55.8%</td>
<td>134</td>
<td>3.890 ETH</td>
</tr>
<tr>
<td><span class="rank">4</span></td>
<td class="wallet-address">0x329a7b10...e89c4</td>
<td class="profit">5.620 ETH</td>
<td class="profit">+0.281 ETH</td>
<td class="win-rate">62.1%</td>
<td>98</td>
<td>2.740 ETH</td>
</tr>
<tr>
<td><span class="rank">5</span></td>
<td class="wallet-address">0x7f2e8b45...c91d3</td>
<td class="profit">4.760 ETH</td>
<td class="profit">+0.238 ETH</td>
<td class="win-rate">57.3%</td>
<td>125</td>
<td>3.210 ETH</td>
</tr>
<tr>
<td><span class="rank">6</span></td>
<td class="wallet-address">0x4d6a9c12...f84e7</td>
<td class="profit">4.500 ETH</td>
<td class="profit">+0.225 ETH</td>
<td class="win-rate">59.4%</td>
<td>112</td>
<td>2.890 ETH</td>
</tr>
<tr>
<td><span class="rank">7</span></td>
<td class="wallet-address">0x9e3b7f28...a65c1</td>
<td class="profit">3.900 ETH</td>
<td class="profit">+0.195 ETH</td>
<td class="win-rate">54.7%</td>
<td>108</td>
<td>2.650 ETH</td>
</tr>
<tr>
<td><span class="rank">8</span></td>
<td class="wallet-address">0x2c8d4e76...b93f5</td>
<td class="profit">3.440 ETH</td>
<td class="profit">+0.172 ETH</td>
<td class="win-rate">56.9%</td>
<td>95</td>
<td>2.340 ETH</td>
</tr>
<tr>
<td><span class="rank">9</span></td>
<td class="wallet-address">0x6f1a5c89...d72e8</td>
<td class="profit">3.180 ETH</td>
<td class="profit">+0.159 ETH</td>
<td class="win-rate">58.1%</td>
<td>89</td>
<td>2.180 ETH</td>
</tr>
<tr>
<td><span class="rank">10</span></td>
<td class="wallet-address">0x5b9e2d47...c84a6</td>
<td class="profit">2.780 ETH</td>
<td class="profit">+0.139 ETH</td>
<td class="win-rate">55.2%</td>
<td>87</td>
<td>2.050 ETH</td>
</tr>
</tbody>
</table>
</main>

<footer>
<div class="container">
<div class="footer-content">
<div class="logo">
<span class="logo-icon">‚öîÔ∏è</span>
<span>Cambria Duel Tracker</span>
</div>
<p>Track and analyze Cambria Duel Arena data on the Abstract L2 chain</p>
<div class="social-links">
<a href="#"><span>ùïè</span></a>
<a href="#"><span>ùêå</span></a>
<a href="#"><span>ùêÜ</span></a>
</div>
<p>¬© 2023 Cambria Duel Tracker. Not affiliated with @playcambria.</p>
</div>
</div>
</footer>

<script>
// Cambria Duel Arena Leaderboard - Smart Contract Integration
document.addEventListener('DOMContentLoaded', function() {
    // Load saved theme first
    loadSavedTheme();
    initializeLeaderboard();
});

async function initializeLeaderboard() {
    // Initialize Web3 in read-only mode
    try {
        const success = await window.cambriaWeb3.initialize();
        if (success) {
            console.log('Web3 initialized for leaderboard');
        }
    } catch (error) {
        console.log('Web3 initialization failed, using mock data:', error);
    }
    
    // Set up event listeners
    setupEventListeners();
    
    // Load initial data
    await loadLeaderboardData('profit');
    
    // Set up real-time updates
    setupRealTimeUpdates();
}

function setupEventListeners() {
    const filterBtns = document.querySelectorAll('.filter-btn');
    
    filterBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            // Remove active class from all buttons
            filterBtns.forEach(b => b.classList.remove('active'));
            // Add active class to clicked button
            this.classList.add('active');
            
            const filter = this.dataset.filter;
            // Update table based on filter
            loadLeaderboardData(filter);
        });
    });
    
    // Listen for Web3 events
    window.cambriaWeb3.addEventListener('duelCompleted', handleDuelCompleted);
}

async function loadLeaderboardData(sortBy = 'profit') {
    try {
        setLoadingState(true);
        
        let leaderboardData;
        
        // Try to get data from smart contracts first
        if (window.cambriaWeb3.isConnected) {
            leaderboardData = await window.cambriaWeb3.getLeaderboardData(sortBy);
        } else {
            // Fallback to mock data
            leaderboardData = getMockLeaderboardData(sortBy);
        }
        
        updateTable(leaderboardData);
        
    } catch (error) {
        console.error('Error loading leaderboard data:', error);
        // Fallback to mock data
        const mockData = getMockLeaderboardData(sortBy);
        updateTable(mockData);
        window.cambriaWeb3.showError('Failed to load live data. Showing cached data.');
    } finally {
        setLoadingState(false);
    }
}

function getMockLeaderboardData(sortBy) {
    // Mock data with corrected fee calculations
    const mockData = {
        profit: [
            { rank: 1, wallet: '0x8a34c7a0...b2d1f', totalETHWon: '8.200 ETH', profit: '+0.412 ETH', winRate: '60.6%', duels: 142, volume: '4.582 ETH' },
            { rank: 2, wallet: '0xab45f1c2...d67b9', totalETHWon: '7.800 ETH', profit: '+0.390 ETH', winRate: '58.2%', duels: 156, volume: '5.120 ETH' },
            { rank: 3, wallet: '0xcf89d1e0...a43e2', totalETHWon: '6.480 ETH', profit: '+0.324 ETH', winRate: '55.8%', duels: 134, volume: '3.890 ETH' },
            { rank: 4, wallet: '0x329a7b10...e89c4', totalETHWon: '5.620 ETH', profit: '+0.281 ETH', winRate: '62.1%', duels: 98, volume: '2.740 ETH' },
            { rank: 5, wallet: '0x6f1a5c89...d72e8', totalETHWon: '3.180 ETH', profit: '+0.159 ETH', winRate: '58.1%', duels: 89, volume: '2.180 ETH' }
        ],
        wins: [
            { rank: 1, wallet: '0xab45f1c2...d67b9', totalETHWon: '7.800 ETH', profit: '+0.390 ETH', winRate: '58.2%', duels: 156, volume: '5.120 ETH' },
            { rank: 2, wallet: '0x8a34c7a0...b2d1f', totalETHWon: '8.200 ETH', profit: '+0.412 ETH', winRate: '60.6%', duels: 142, volume: '4.582 ETH' },
            { rank: 3, wallet: '0xcf89d1e0...a43e2', totalETHWon: '6.480 ETH', profit: '+0.324 ETH', winRate: '55.8%', duels: 134, volume: '3.890 ETH' },
            { rank: 4, wallet: '0x329a7b10...e89c4', totalETHWon: '5.620 ETH', profit: '+0.281 ETH', winRate: '62.1%', duels: 98, volume: '2.740 ETH' },
            { rank: 5, wallet: '0x6f1a5c89...d72e8', totalETHWon: '3.180 ETH', profit: '+0.159 ETH', winRate: '58.1%', duels: 89, volume: '2.180 ETH' }
        ],
        winrate: [
            { rank: 1, wallet: '0x329a7b10...e89c4', totalETHWon: '5.620 ETH', profit: '+0.281 ETH', winRate: '62.1%', duels: 98, volume: '2.740 ETH' },
            { rank: 2, wallet: '0x8a34c7a0...b2d1f', totalETHWon: '8.200 ETH', profit: '+0.412 ETH', winRate: '60.6%', duels: 142, volume: '4.582 ETH' },
            { rank: 3, wallet: '0x6f1a5c89...d72e8', totalETHWon: '3.180 ETH', profit: '+0.159 ETH', winRate: '58.1%', duels: 89, volume: '2.180 ETH' },
            { rank: 4, wallet: '0xab45f1c2...d67b9', totalETHWon: '7.800 ETH', profit: '+0.390 ETH', winRate: '58.2%', duels: 156, volume: '5.120 ETH' },
            { rank: 5, wallet: '0xcf89d1e0...a43e2', totalETHWon: '6.480 ETH', profit: '+0.324 ETH', winRate: '55.8%', duels: 134, volume: '3.890 ETH' }
        ],
        volume: [
            { rank: 1, wallet: '0xab45f1c2...d67b9', totalETHWon: '7.800 ETH', profit: '+0.390 ETH', winRate: '58.2%', duels: 156, volume: '5.120 ETH' },
            { rank: 2, wallet: '0x8a34c7a0...b2d1f', totalETHWon: '8.200 ETH', profit: '+0.412 ETH', winRate: '60.6%', duels: 142, volume: '4.582 ETH' },
            { rank: 3, wallet: '0xcf89d1e0...a43e2', totalETHWon: '6.480 ETH', profit: '+0.324 ETH', winRate: '55.8%', duels: 134, volume: '3.890 ETH' },
            { rank: 4, wallet: '0x329a7b10...e89c4', totalETHWon: '5.620 ETH', profit: '+0.281 ETH', winRate: '62.1%', duels: 98, volume: '2.740 ETH' },
            { rank: 5, wallet: '0x6f1a5c89...d72e8', totalETHWon: '3.180 ETH', profit: '+0.159 ETH', winRate: '58.1%', duels: 89, volume: '2.180 ETH' }
        ]
    };
    
    return mockData[sortBy] || mockData.profit;
}

function updateTable(data) {
    const table = document.getElementById('leaderboardTable');
    const tbody = table.querySelector('tbody');
    tbody.innerHTML = '';
    
    if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">No leaderboard data available</td></tr>';
        return;
    }
    
    data.forEach(player => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td><span class="rank rank-${player.rank <= 3 ? player.rank : ''}">${player.rank}</span></td>
            <td class="wallet-address">${player.wallet}</td>
            <td class="profit">${player.totalETHWon}</td>
            <td class="profit">${player.profit}</td>
            <td class="win-rate">${player.winRate}</td>
            <td>${player.duels}</td>
            <td>${player.volume}</td>
        `;
        tbody.appendChild(row);
    });
}

function setupRealTimeUpdates() {
    // Set up periodic data refresh
    setInterval(async () => {
        if (window.cambriaWeb3.isConnected) {
            const activeFilter = document.querySelector('.filter-btn.active');
            if (activeFilter) {
                const filter = activeFilter.dataset.filter;
                try {
                    await loadLeaderboardData(filter);
                } catch (error) {
                    console.error('Real-time update failed:', error);
                }
            }
        }
    }, CONFIG.UI.REFRESH_INTERVAL);
}

function handleDuelCompleted(data) {
    console.log('Duel completed, refreshing leaderboard:', data);
    
    // Refresh leaderboard after a short delay
    setTimeout(async () => {
        const activeFilter = document.querySelector('.filter-btn.active');
        if (activeFilter) {
            const filter = activeFilter.dataset.filter;
            await loadLeaderboardData(filter);
        }
    }, 3000);
}

function setLoadingState(isLoading) {
    const table = document.getElementById('leaderboardTable');
    const filterBtns = document.querySelectorAll('.filter-btn');
    
    if (isLoading) {
        table.classList.add('loading');
        filterBtns.forEach(btn => btn.disabled = true);
    } else {
        table.classList.remove('loading');
        filterBtns.forEach(btn => btn.disabled = false);
    }
}

// Add loading styles
const style = document.createElement('style');
style.textContent = `
    .leaderboard-table.loading {
        opacity: 0.6;
        pointer-events: none;
    }
    
    .leaderboard-table.loading::after {
        content: 'Loading...';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: var(--secondary);
        font-weight: 500;
    }
`;
document.head.appendChild(style);

// Chain switching functionality
function switchChain(chain) {
    if (CONFIG.switchChain(chain)) {
        // Update UI
        document.querySelectorAll('.chain-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-chain="${chain}"]`).classList.add('active');
        
        // Update web3 connection
        if (window.cambriaWeb3) {
            window.cambriaWeb3.updateChainConfig();
        }
        
        // Refresh data
        if (typeof loadLeaderboardData === 'function') {
            loadLeaderboardData();
        }
        
        // Show notification
        showNotification(`Switched to ${CONFIG.getCurrentChain().CHAIN_NAME}`, 'success');
    }
}

// Load saved theme on page load
function loadSavedTheme() {
    if (CONFIG.loadTheme()) {
        // Update UI to reflect saved theme
        document.querySelectorAll('.chain-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.querySelector(`[data-chain="${CONFIG.ACTIVE_CHAIN}"]`).classList.add('active');
    }
}

// Show notification
function showNotification(message, type = 'info') {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    
    // Style the notification
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: var(--primary);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 1000;
        font-weight: 500;
        transform: translateX(100%);
        transition: transform 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    // Animate in
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 100);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}
</script>
</body>
</html>